<!-- 
  event timeline: renders the timeline of all different tasks in an event
  	
  requires event id to be in parameters
 -->

<style>.schedule, .schedule2{
    width: 400px;
    background-color: #c0392b;
    border: #ecf0f1 solid 1px;
    padding: 3px;
}

.schedule:hover, .schedule2:hover{
    background-color: #e74c3c;
}</style>

<div id="schedule"></div>

<script type="text/javascript">

!function(a){a.fn.btsListFilter=function(b,c){function d(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){return b[c]||""})}function e(a,b){var c;return b=b||300,function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,Array.prototype.slice.call(e))},b)}}var f,g=this,h=a(this),i=a(b),j=h;return c=a.extend({delay:300,minLength:1,initial:!0,eventKey:"keyup",resetOnBlur:!0,sourceData:null,sourceTmpl:'<a class="list-group-item" href="#"><span>{title}</span></a>',sourceNode:function(a){return d(c.sourceTmpl,a)},emptyNode:function(){return'<a class="list-group-item well" href="#"><span>No Results</span></a>'},itemEl:".list-group-item",itemChild:null,itemFilter:function(b,d){d=d&&d.replace(new RegExp("[({[^.$*+?\\]})]","g"),"");var e=a(b).text(),f=c.initial?"^":"",g=new RegExp(f+d,"i");return g.test(e)}},c),i.on(c.eventKey,e(function(){var b=a(this).val();c.itemEl&&(j=h.find(c.itemEl)),c.itemChild&&(j=j.find(c.itemChild));var d=j.filter(function(){return c.itemFilter.call(g,this,b)}),e=j.not(d);c.itemChild&&(d=d.parents(c.itemEl),e=e.parents(c.itemEl).hide()),""!==b&&b.length>=c.minLength?(d.show(),e.hide(),"function"===a.type(c.sourceData)?(d.hide(),e.hide(),f&&(a.isFunction(f.abort)?f.abort():a.isFunction(f.stop)&&f.stop()),f=c.sourceData.call(g,b,function(b){if(f=null,d.hide(),e.hide(),h.find(".bts-dynamic-item").remove(),b&&0!==b.length)for(var i in b)a(c.sourceNode.call(g,b[i])).addClass("bts-dynamic-item").appendTo(h);else a(c.emptyNode.call(g)).addClass("bts-dynamic-item").appendTo(h)})):0===d.length&&a(c.emptyNode.call(g)).addClass("bts-dynamic-item").appendTo(h)):(d.show(),e.show(),h.find(".bts-dynamic-item").remove())},c.delay)),c.resetOnBlur&&i.on("blur",function(){a(this).val("").trigger(c.eventKey)}),h}}(jQuery);

safeGet("/event/" + {{id}}, function (data) {
	// tasks
	tasks = []
	data.task_list.map(function (task_id, index) {
		// get task data
		safeGet("/task/" + task_id, function (task_data) {
			// append list item
			start = new Date(task_data.start_time);
			end = new Date(task_data.end_time);
			tasks.push({title: task_data.name,
						start: strftime('%y/%m/%d %H:%M', start),
						end: strftime('%y/%m/%d %H:%M', end)});
						
			if (tasks.length == data.task_list.length) {
				$('#schedule').graspSchedule({
					schedules:tasks,
					options:{
						css:{
							schedule:{
								height:"70px"
							},
							zIndexStart:0,
							marginTop:"0px",
							marginLeft:"0px",
						},
						time:true,//show time on left side
						insideTime:false,//show time inside
						timeFormat:'ddd HH:mm',
						daysFormat:['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
					}
				});	
			}
		});
	});
});

</script>
